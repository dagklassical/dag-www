<---
// Layout Base - DAG Klassical (Centralizado)
// Archivo: src/layouts/Layout.astro
// Propósito: Layout base con CSS y componentes centralizados
// Reemplaza todos los layouts inline por una arquitectura profesional
---

// Props del layout
interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  noindex?: boolean;
}

const { 
  title, 
  description = "DAG Klassical - Plataforma de música clásica con tecnología blockchain y NFTs",
  image = "/logo-dag.svg",
  type = "website",
  noindex = false
} = Astro.props;

// CSS Centralizado Importado
import '../styles/global.css';
// Componentes Centralizados
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Meta tags y SEO centralizados
const baseUrl = import.meta.env.BASE_URL || '';
const fullTitle = title.includes('DAG Klassical') ? title : `${title} | DAG Klassical`;
const fullImage = image.startsWith('http') ? image : `${baseUrl}${image}`;
const canonicalUrl = `${baseUrl}${Astro.url.pathname}`;
---

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Título SEO -->
    <title>{fullTitle}</title>
    
    <!-- Meta Tags -->
    <meta name="description" content={description} />
    <meta name="keywords" content="música clásica, blockchain, NFT, arte digital, inversores, coleccionistas" />
    <meta name="author" content="DAG Klassical" />
    <meta name="robots" content={noindex ? 'noindex, nofollow' : 'index, follow'} />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalUrl} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={fullImage} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content="DAG Klassical" />
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={fullImage} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    
    <!-- Preconnect para performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Structured Data para SEO -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "DAG Klassical",
        "description": description,
        "url": baseUrl,
        "logo": `${baseUrl}/logo-dag.svg`,
        "sameAs": [
          "https://twitter.com/dagklassical",
          "https://instagram.com/dagklassical",
          "https://youtube.com/dagklassical"
        ],
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+58-xxx-xxxx",
          "contactType": "Customer Service",
          "areaServed": "VE",
          "availableLanguage": "Spanish"
        }
      })}
    </script>
  </head>
  
  <body>
    <!-- Header Centralizado -->
    <Header />
    
    <!-- Contenido Principal -->
    <main class="main-content">
      <slot />
    </main>
    
    <!-- Footer Centralizado -->
    <Footer />
    
    <!-- Scripts de funcionalidad centralizados -->
    <script>
      // Smooth scroll para toda la página
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
      
      // Lazy loading para imágenes
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              if (img.dataset.src) {
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                observer.unobserve(img);
              }
            }
          });
        });
        
        document.querySelectorAll('img[data-src]').forEach(img => {
          imageObserver.observe(img);
        });
      }
      
      // Analytics (placeholder)
      console.log('Página cargada:', window.location.pathname);
    </script>
  </body>
</html>

<style>
  /* Estilos específicos del layout base */
  .main-content {
    min-height: calc(100vh - 200px); /* Aproximadamente altura del header + footer */
    padding-top: var(--spacing-lg);
  }
  
  /* Accesibilidad */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Focus visible para navegación por teclado */
  *:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }
  
  /* Skip to content link */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 6px;
    background: var(--color-primary);
    color: white;
    padding: 8px;
    border-radius: var(--border-radius-sm);
    text-decoration: none;
    z-index: 10000;
    transition: top 0.3s;
  }
  
  .skip-link:focus {
    top: 6px;
  }
</style>